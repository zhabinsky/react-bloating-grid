"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _react=_interopRequireWildcard(require("react")),_isServer=_interopRequireDefault(require("./isServer"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!(i&&_arr.length===i));_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i["return"]||_i["return"]()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _extends(){return _extends=Object.assign||function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i],source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target},_extends.apply(this,arguments)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var gatherExpectedBreakpoints=function(props,checkFields){for(var expectedBreakpoints=[],i=0;i<checkFields.length;i++){var name=checkFields[i],value=props[name];if(value&&"object"===_typeof(value))// prop value is not an object, therefore
// is kept as is -> primitive or null
{// TODO: elimintate reverse call as optimization
var breakpoints=Object.keys(value);expectedBreakpoints.push.apply(expectedBreakpoints,_toConsumableArray(breakpoints))}}return _toConsumableArray(new Set(expectedBreakpoints)).map(Number).sort(sortFunction)},withResolvedBreakpoints=function(Component,checkFields){return function(props){for(var expectedBreakpoints=gatherExpectedBreakpoints(props,checkFields),width=useWidthWithBreakpoints(expectedBreakpoints),resolvedProps={},i=0;i<checkFields.length;i++){var name=checkFields[i],value=props[name];if(value&&"object"===_typeof(value))// prop value is not an object, therefore
// is kept as is
{// TODO: elimintate reverse call as optimization
var breakpoints=Object.keys(value).map(Number).sort(sortFunction),currentBreakpoint=getAchievedBreakpoint(width,breakpoints),selectedValue=value[currentBreakpoint];resolvedProps[name]=selectedValue}}return console.log(resolvedProps,props),_react["default"].createElement(Component,_extends({},props,resolvedProps))}},_default=withResolvedBreakpoints;exports["default"]=_default;var getWidth=function(){return _isServer["default"]?800:window.innerWidth},useWidthWithBreakpoints=function(bpoints){var _useState=(0,_react.useState)(0),_useState2=_slicedToArray(_useState,2),breakpoint=_useState2[0],setBreakpoint=_useState2[1],width=getWidth();return(0,_react.useEffect)(function(){var handleResize=function(){var current=getAchievedBreakpoint(getWidth(),bpoints);breakpoint!==current&&setBreakpoint(current)};return(handleResize(),_isServer["default"])?function(){return null}:(window.addEventListener("resize",handleResize),function(){return window.removeEventListener("resize",handleResize)})}),width},getAchievedBreakpoint=function(width,breakpoints){for(var breakpoint,j=0;j<breakpoints.length;j++)if(width>=breakpoints[j]){breakpoint=breakpoints[j];break}return"undefined"==typeof breakpoint&&(breakpoint=breakpoints[breakpoints.length-1]),breakpoint},sortFunction=function(a,b){return b-a};